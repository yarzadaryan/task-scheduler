import{d,r as n,e as ve,a as Ne,j as t,L as we}from"./index-CJ2zOIo3.js";import{S as R,b as De,a as le,I as Se}from"./Select-BHHg53YM.js";import{T as I,C as Te,B as Ce}from"./Banner-wAvLw2Uf.js";function Pe(){const b=d(e=>e.tasks),H=d(e=>e.addTask),W=d(e=>e.toggleTask),N=d(e=>e.removeTask),p=d(e=>e.presets),F=d(e=>e.addPreset),ne=d(e=>e.removePreset),[L,O]=n.useState(""),[x,ce]=n.useState(()=>new Date().toISOString().slice(0,10)),[u,U]=n.useState(""),[g,G]=n.useState(""),[w,D]=n.useState(""),[S,K]=n.useState(!1),[T,Y]=n.useState(""),[C,q]=n.useState(""),{toast:h}=ve(),A=d(e=>e.todayNote),z=d(e=>e.notes),E=d(e=>e.loadNotes),J=d(e=>e.loadNoteByDate),de=d(e=>e.saveNoteForDate),ie=d(e=>e.deleteNoteById),oe=Ne(),[Q,M]=n.useState(""),[f,re]=n.useState(()=>{const e=new Date;return e.setHours(0,0,0,0),e.getTime()}),[P,k]=n.useState(null);n.useEffect(()=>{E()},[E]),n.useEffect(()=>{J(f)},[f,J]),n.useEffect(()=>{M(A?.content??"")},[A]);const{todayPresets:j,otherTasks:V}=n.useMemo(()=>{const e=new Date;e.setHours(0,0,0,0);const s=e.getTime(),c=s+1440*60*1e3-1,i=l=>typeof l=="number"&&l>=s&&l<=c,a=new Set(p),o=b.filter(l=>a.has(l.title)&&i(l.dueAt??null)),r=b.filter(l=>!(a.has(l.title)&&i(l.dueAt??null)));return{todayPresets:o,otherTasks:r}},[b,p]);function xe(e){const s=new Date(e);return s.setHours(0,0,0,0),s.getTime()}const X=n.useMemo(()=>{const e=[];for(let s=0;s<24;s++)for(let c=0;c<60;c+=30){const i=String(s).padStart(2,"0"),a=String(c).padStart(2,"0");e.push(`${i}:${a}`)}return e},[]),me=n.useMemo(()=>{const e=new Map,s=xe(Date.now());for(const c of p){let i=0,a=s;for(let o=0;o<365;o++){const r=a+864e5-1;if(!b.some(y=>y.title===c&&(y.dueAt??0)>=a&&(y.dueAt??0)<=r&&!!y.completedAt))break;i+=1,a-=1440*60*1e3}e.set(c,i)}return e},[b,p]),Z=d(e=>e.addEvent),_=d(e=>e.removeEvent);function m(e,s){const[c,i,a]=e.split("-").map(Number),[o,r]=s.split(":").map(Number);return new Date(c,i-1,a,o||0,r||0,0,0).getTime()}async function ue(){const e=L.trim();if(!e)return;let s;if(x&&(u?s=m(x,u):s=m(x,"00:00")),await H({title:e,dueAt:s}),x&&u&&g){const c=m(x,"00:00"),i=c+1440*60*1e3,a=d.getState().events.find(l=>l.title.replace(/\s*✅$/,"")===e&&l.allDay&&l.start>=c&&l.start<i);a&&await _(a.id);const o=m(x,u),r=Math.max(o+900*1e3,m(x,g));await Z({title:e,start:o,end:r,allDay:!1})}if(S&&x){const c=m(x,"00:00");let i=4;if(T){const a=m(T,"00:00");a>c&&(i=Math.max(1,Math.floor((a-c)/(10080*60*1e3))))}for(let a=1;a<=i;a++){const o=a*7*24*60*60*1e3,r=c+o,l=new Date(r),y=l.getFullYear(),fe=String(l.getMonth()+1).padStart(2,"0"),ye=String(l.getDate()).padStart(2,"0"),$=`${y}-${fe}-${ye}`,ge=u?m($,u):r;if(await H({title:e,dueAt:ge}),u&&g){const te=r,ke=te+1440*60*1e3,se=d.getState().events.find(v=>v.title.replace(/\s*✅$/,"")===e&&v.allDay&&v.start>=te&&v.start<ke);se&&await _(se.id);const ae=m($,u),je=Math.max(ae+900*1e3,m($,g));await Z({title:e,start:ae,end:je,allDay:!1})}}}O(""),U(""),G(""),K(!1),Y(""),k({tone:"success",message:"Task created"}),h({type:"success",title:"Task added",message:e})}const he=j.filter(e=>!!e.completedAt).length,be=j.length,B=n.useMemo(()=>{const e=new Date;return e.setHours(0,0,0,0),e.getTime()},[]),ee=B+1440*60*1e3-1,pe=n.useMemo(()=>b.filter(e=>(e.dueAt??0)>=B&&(e.dueAt??0)<=ee),[b,B,ee]);return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"flex items-end justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Tasks"}),t.jsx("p",{className:"text-sm text-black/60",children:"Daily check-ins and everything else"})]}),t.jsxs("div",{className:"rounded-full bg-black/5 text-black/70 text-xs px-3 py-1",children:["Today ",he,"/",be]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[t.jsxs("div",{className:"rounded-2xl border border-black/5 bg-white/70 backdrop-blur p-4 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Today's Check-ins"}),t.jsx("span",{className:"text-xs text-black/50",children:"Auto-added"})]}),t.jsxs("ul",{className:"divide-y divide-black/5",children:[j.length===0&&t.jsx("li",{className:"p-3 text-sm text-black/60",children:"No check-ins found for today"}),j.map(e=>t.jsxs("li",{className:"flex items-center justify-between p-3",children:[t.jsxs("label",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",checked:!!e.completedAt,onChange:async()=>{await W(e.id),h({type:"success",message:e.completedAt?"Marked incomplete":"Checked in!"})},className:"h-4 w-4 rounded border-black/20 text-blue-600 focus:ring-blue-500/30"}),t.jsx("span",{className:e.completedAt?"line-through text-black/50":"",children:e.title}),t.jsxs("span",{className:"ml-2 text-xs rounded-full bg-black/5 px-2 py-0.5 text-black/70",children:[me.get(e.title)||0,"d"]})]}),t.jsx("button",{onClick:async()=>{await N(e.id),k({tone:"critical",message:"Task deleted"}),h({type:"info",message:"Deleted"})},className:"text-xs text-red-600 hover:text-red-700",children:"Delete"})]},e.id))]})]}),t.jsxs("div",{className:"rounded-2xl border border-black/5 bg-white/70 backdrop-blur p-4 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Presets"}),t.jsx("span",{className:"text-xs text-black/50",children:"Daily check-ins"})]}),t.jsxs("div",{className:"flex gap-2 mb-3",children:[t.jsx("input",{value:w,onChange:e=>D(e.target.value),placeholder:"Add preset (e.g., Read)",className:"w-full rounded-xl border border-black/10 bg-white px-3 py-2 shadow-sm outline-none focus:ring-2 focus:ring-blue-500/20",onKeyDown:e=>e.key==="Enter"&&(()=>{const s=w.trim();s&&(F(s),D(""),h({type:"success",message:"Preset added"}))})()}),t.jsx("button",{onClick:()=>{const e=w.trim();e&&(F(e),D(""),h({type:"success",message:"Preset added"}))},className:"inline-flex items-center gap-1 rounded-xl bg-black text-white px-4 py-2 hover:bg-black/90",children:"Add"})]}),t.jsxs("ul",{className:"divide-y divide-black/5",children:[p.length===0&&t.jsx("li",{className:"p-3 text-sm text-black/60",children:"No presets"}),p.map(e=>t.jsxs("li",{className:"flex items-center justify-between p-3 text-sm",children:[t.jsx("span",{children:e}),t.jsx("button",{onClick:()=>{ne(e),h({type:"info",message:"Preset removed"})},className:"text-xs text-red-600 hover:text-red-700",children:"Remove"})]},e))]})]})]}),t.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[t.jsxs("div",{className:"rounded-2xl border border-black/5 bg-white/70 backdrop-blur p-4 shadow-sm",children:[t.jsxs("div",{className:"mb-3 flex items-end justify-between gap-3",children:[t.jsx("div",{style:{minWidth:280},children:t.jsx(R,{label:"Today's tasks",options:[{label:"Select a task",value:""},...pe.map(e=>({label:e.title,value:e.id}))],value:C,onChange:q})}),t.jsx(De,{children:t.jsx(le,{tone:"critical",onClick:async()=>{C&&(await N(C),q(""),k({tone:"critical",message:"Task deleted"}))},children:"Delete"})})]}),t.jsxs(Se,{gap:"200",align:"space-between",blockAlign:"end",wrap:!0,children:[t.jsx("div",{style:{minWidth:260},children:t.jsx(I,{label:"Task",value:L,onChange:O,autoComplete:"off",placeholder:"What to do"})}),t.jsx("div",{children:t.jsx(I,{label:"Date",type:"date",value:x,onChange:ce,autoComplete:"off"})}),t.jsx("div",{children:t.jsx(R,{label:"Start",options:[{label:"All-day",value:""},...X.map(e=>({label:e,value:e}))],value:u,onChange:U})}),t.jsx("div",{children:t.jsx(R,{label:"End",options:[{label:"—",value:""},...X.map(e=>({label:e,value:e}))],value:g,onChange:G})}),t.jsx("div",{children:t.jsx(le,{variant:"primary",onClick:ue,children:"Add"})})]}),t.jsxs("div",{className:"mt-3 space-y-2",children:[t.jsx(Te,{label:"Repeat weekly",checked:S,onChange:K}),S&&t.jsx("div",{style:{maxWidth:260},children:t.jsx(I,{label:"Repeat until (optional)",type:"date",value:T,onChange:Y,autoComplete:"off",helpText:"Default is 4 weeks if left blank"})})]}),P&&t.jsx("div",{className:"mt-3",children:t.jsx(Ce,{tone:P.tone,title:P.message,onDismiss:()=>k(null)})})]}),t.jsxs("div",{className:"rounded-2xl border border-black/5 bg-white/70 backdrop-blur p-4 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Daily Diary"}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("span",{className:"text-xs text-black/50",children:["Note for ",new Date(f).toLocaleDateString()]}),t.jsx(we,{to:`/diary/${f}`,className:"text-xs underline underline-offset-4",title:"Open in Diary",children:"Open in Diary"})]})]}),t.jsx("textarea",{value:Q,onChange:e=>M(e.target.value),placeholder:"How was your day? Thoughts, reflections, duas...",className:"w-full min-h-[120px] rounded-xl border border-black/10 bg-white px-3 py-2 shadow-sm outline-none focus:ring-2 focus:ring-blue-500/20"}),t.jsx("div",{className:"mt-3 flex justify-end",children:t.jsx("button",{onClick:async()=>{await de(f,Q),await E(),h({type:"success",message:"Saved"})},className:"inline-flex items-center gap-1 rounded-xl bg-black text-white px-4 py-2 hover:bg-black/90",children:"Save"})})]}),t.jsx("div",{className:"rounded-2xl border border-black/5 bg-white/70 backdrop-blur p-2 shadow-sm",children:t.jsxs("ul",{className:"divide-y divide-black/5",children:[V.length===0&&t.jsx("li",{className:"p-4 text-sm text-black/60",children:"No tasks yet"}),V.map(e=>t.jsxs("li",{className:"flex items-center justify-between p-3",children:[t.jsxs("label",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",checked:!!e.completedAt,onChange:()=>W(e.id),className:"h-4 w-4 rounded border-black/20 text-blue-600 focus:ring-blue-500/30"}),t.jsx("span",{className:e.completedAt?"line-through text-black/50":"",children:e.title})]}),t.jsx("button",{onClick:async()=>{await N(e.id),h({type:"info",message:"Deleted"})},className:"text-xs text-red-600 hover:text-red-700",children:"Delete"})]},e.id))]})}),t.jsxs("div",{className:"rounded-2xl border border-black/5 bg-white/70 backdrop-blur p-4 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Diary History"}),t.jsx("span",{className:"text-xs text-black/50",children:"Recent notes"})]}),t.jsxs("ul",{className:"divide-y divide-black/5",children:[z.length===0&&t.jsx("li",{className:"p-3 text-sm text-black/60",children:"No entries yet"}),z.slice().sort((e,s)=>s.date-e.date).map(e=>t.jsxs("li",{className:"p-3 flex items-center justify-between",children:[t.jsx("button",{className:`text-sm underline underline-offset-4 ${f===e.date?"font-semibold":""}`,onClick:()=>{re(e.date),oe(`/diary/${e.date}`)},children:new Date(e.date).toLocaleDateString()}),t.jsx("button",{onClick:async()=>{await ie(e.id),A?.id===e.id&&M(""),h({type:"info",message:"Deleted note"})},className:"text-xs text-red-600 hover:text-red-700",title:"Delete note",children:"Delete"})]},e.id))]})]})]})]})]})}export{Pe as default};
